<Window x:Class="TicketBookingWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TicketBookingWPF.ViewModel"
        Title="AUSTRIA Ticket by SKH - Buchungsplattform für den KT Verleih" Height="720" Width="1100">
    
    <!-- Darstellungs Config für komplett ausgebuchten Tag -->
    <Window.Resources>
        <vm:DateToStrikethroughConverter x:Key="DateToStrikethroughConverter"/>
        <vm:DateToBackgroundConverter x:Key="DateToBackgroundConverter"/>
        <vm:DateToForegroundConverter x:Key="DateToForegroundConverter"/>
        
        <!-- Sicherstellen, dass der Style im richtigen Scope deklariert ist -->
        <Style x:Key="FullyBookedCalendarDayButtonStyle" TargetType="{x:Type CalendarDayButton}">
            <Setter Property="MinWidth" Value="28"/>
            <Setter Property="MinHeight" Value="28"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CalendarDayButton">
                        <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="2"
                                CornerRadius="3">
                            <Border.Background>
                                <MultiBinding Converter="{StaticResource DateToBackgroundConverter}" ConverterParameter="">
                                    <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="DataContext"/>
                                    <Binding Path="DataContext.FullyBookedDates" RelativeSource="{RelativeSource AncestorType=Calendar}"/>
                                </MultiBinding>
                            </Border.Background>
                            <TextBlock Text="{TemplateBinding Content}" 
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"
                                      FontWeight="SemiBold">
                                <TextBlock.Foreground>
                                    <MultiBinding Converter="{StaticResource DateToForegroundConverter}" ConverterParameter="">
                                        <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="DataContext"/>
                                        <Binding Path="DataContext.FullyBookedDates" RelativeSource="{RelativeSource AncestorType=Calendar}"/>
                                    </MultiBinding>
                                </TextBlock.Foreground>
                            </TextBlock>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    

    <DockPanel>

        <!-- MENU -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_Datei">
                <MenuItem Header="_Neu..." Command="{Binding NewBookingCommand}" />
                <Separator/>
                <MenuItem Header="_Beenden" Command="{Binding ExitCommand}" />
            </MenuItem>

            <MenuItem Header="_Bearbeiten">
                <MenuItem Header="_Kopieren..." Command="{Binding CopyBookingCommand}" />
                <MenuItem Header="_Löschen" Command="{Binding DeleteCommand}" />
            </MenuItem>
        </Menu>

        <!-- TOOLBAR -->
        <ToolBarTray DockPanel.Dock="Top">
            <ToolBar>
                <Button Content="Neu" Command="{Binding NewBookingCommand}" ToolTip="Neue Buchung anlegen (Dialog mit DatePicker)" />
                <Button Content="Kopieren" Command="{Binding CopyBookingCommand}" ToolTip="Ausgewählte Buchung kopieren (Daten werden vorbefüllt, nächster freier Tag wird vorgeschlagen)" />
                <Separator/>
                <Button Content="Beenden" Command="{Binding ExitCommand}" ToolTip="Anwendung schließen" />
            </ToolBar>
        </ToolBarTray>

        <!-- STATUSBAR -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}" />
            </StatusBarItem>
        </StatusBar>

        <!-- CONTENT -->
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="360"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LINKS -->
            <StackPanel Grid.Column="0">
                <TextBlock Text="Tag auswählen" FontWeight="SemiBold" Margin="0,0,0,6"/>
                <Calendar SelectedDate="{Binding SelectedDate}"
                          CalendarDayButtonStyle="{StaticResource FullyBookedCalendarDayButtonStyle}"
                          ToolTip="Wähle den Tag, für den du die Ticketverfügbarkeit sehen willst."/>

                <TextBlock Text="Tickets (Status)" FontWeight="SemiBold" Margin="0,10,0,6"/>

                <ListBox ItemsSource="{Binding Tickets}"
                         SelectedItem="{Binding SelectedTicket}"
                         Height="330">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Margin" Value="0,0,0,6"/>
                        </Style>
                    </ListBox.ItemContainerStyle>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="8" CornerRadius="10" ToolTip="{Binding TooltipText}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="90"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding TicketCode}" FontWeight="SemiBold"/>

                                    <TextBlock Grid.Column="1" Text="{Binding StatusText}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Opacity" Value="0.85"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsBooked}" Value="True">
                                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>

            <!-- RECHTS -->
            <StackPanel Grid.Column="1" Margin="14,0,0,0">
                <TextBlock Text="Details" FontSize="16" FontWeight="SemiBold" Margin="0,0,0,10"/>

                <TextBlock Text="Ausgewähltes Ticket"/>
                <Border Background="White" BorderBrush="#FFABADB3" BorderThickness="1" Padding="2">
                    <TextBlock Text="{Binding SelectedTicket.TicketCode, TargetNullValue='-'}"/>
                </Border>

                <TextBlock Text="Status" Margin="0,10,0,0"/>
                <Border Background="White" BorderBrush="#FFABADB3" BorderThickness="1" Padding="2">
                    <TextBlock Text="{Binding SelectedTicket.StatusText, TargetNullValue='-'}"/>
                </Border>

                <TextBlock Text="Nächster freier Tag" Margin="0,10,0,0"/>
                <Border Background="White" BorderBrush="#FFABADB3" BorderThickness="1" Padding="2">
                    <TextBlock Text="{Binding SelectedTicket.NextFreeDate, StringFormat=dd.MM.yyyy, TargetNullValue='-'}"/>
                </Border>

                <TextBlock Text="Aktionen" FontWeight="SemiBold" Margin="0,14,0,6"/>
                <StackPanel Orientation="Horizontal">
                    <Button Content="Neu..." Command="{Binding NewBookingCommand}" />
                    <Button Content="Kopieren..." Command="{Binding CopyBookingCommand}" />
                    <Button Content="Löschen" Command="{Binding DeleteCommand}" />
                </StackPanel>

                <TextBlock Text="Hinweis" Margin="0,18,0,0" FontWeight="SemiBold"/>
                <TextBlock Text="Buchungen werden über Dialoge angelegt (DatePicker). Copy schlägt automatisch den nächsten freien Tag vor."
                           TextWrapping="Wrap" Opacity="0.85"/>
            </StackPanel>

        </Grid>
    </DockPanel>
</Window>

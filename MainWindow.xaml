<Window x:Class="TicketBookingWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TicketBookingWPF.ViewModel"
        Title="AUSTRIA Ticket by SKH - Buchungsplattform fÃ¼r den KT Verleih" Height="720" Width="1100">
    
    <!-- Darstellungs Config fÃ¼r komplett ausgebuchten Tag -->
    <Window.Resources>
        <vm:DateToBackgroundConverter x:Key="DateToBackgroundConverter"/>
        <vm:DateToForegroundConverter x:Key="DateToForegroundConverter"/>

        <!-- Sicherstellen, dass der Style im richtigen Scope deklariert ist -->
        <Style x:Key="FullyBookedCalendarDayButtonStyle" TargetType="{x:Type CalendarDayButton}">
            <Setter Property="MinWidth" Value="28"/>
            <Setter Property="MinHeight" Value="28"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="CalendarDayButton">
                        <Border BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                Padding="2"
                                CornerRadius="3">
                            <Border.Background>
                                <MultiBinding Converter="{StaticResource DateToBackgroundConverter}" ConverterParameter="">
                                    <!-- Korrigierte Bindings: CalendarDayButton.Content ist das Datum -->
                                    <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="Content"/>
                                    <Binding Path="DataContext.FullyBookedDates" RelativeSource="{RelativeSource AncestorType=Calendar}"/>
                                </MultiBinding>
                            </Border.Background>
                            <TextBlock Text="{TemplateBinding Content}" 
                                      HorizontalAlignment="Center" 
                                      VerticalAlignment="Center"
                                      FontWeight="SemiBold">
                                <TextBlock.Foreground>
                                    <MultiBinding Converter="{StaticResource DateToForegroundConverter}" ConverterParameter="">
                                        <Binding RelativeSource="{RelativeSource TemplatedParent}" Path="Content"/>
                                        <Binding Path="DataContext.FullyBookedDates" RelativeSource="{RelativeSource AncestorType=Calendar}"/>
                                    </MultiBinding>
                                </TextBlock.Foreground>
                            </TextBlock>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    

    <DockPanel>

        <!-- MENU -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_Datei">
                <MenuItem Header="_Neu..." Command="{Binding NewBookingCommand}" />
                <Separator/>
                <MenuItem Header="_Beenden" Command="{Binding ExitCommand}" ToolTip="Anwendung schlieÃŸen"  />
            </MenuItem>

            <MenuItem Header="_Bearbeiten">
                <MenuItem Header="_Kopieren..." Command="{Binding CopyBookingCommand}" />
                <MenuItem Header="_LÃ¶schen" Command="{Binding DeleteCommand}" />
            </MenuItem>
        </Menu>

        <!-- TOOLBAR -->
        <Grid DockPanel.Dock="Top">
            <ToolBarTray>
                <ToolBar>
                    <!-- Verwalten DropDown Button -->
                    <Button Content="Verwalten â–¼" ToolTip="Verwaltungsoptionen">
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="BuchungsÃ¼bersicht" Command="{Binding ShowBookingOverviewCommand}" />
                                <MenuItem Header="Ticketverwaltung" Command="{Binding ManageTicketsCommand}" />
                                <Separator/>
                                <MenuItem Header="Einstellungen" Command="{Binding ShowSettingsCommand}" />
                            </ContextMenu>
                        </Button.ContextMenu>
                        <Button.Style>
                            <Style TargetType="Button">
                                <EventSetter Event="Click" Handler="DropDownButton_Click"/>
                            </Style>
                        </Button.Style>
                    </Button>
                    
                    <!-- Exporte DropDown Button -->
                    <Button Content="Exporte â–¼" ToolTip="Buchungen exportieren">
                        <Button.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Als PDF exportieren..." Command="{Binding ExportPdfCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="ðŸ“„" FontSize="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                                <MenuItem Header="Als Excel exportieren..." Command="{Binding ExportExcelCommand}">
                                    <MenuItem.Icon>
                                        <TextBlock Text="ðŸ“Š" FontSize="14"/>
                                    </MenuItem.Icon>
                                </MenuItem>
                            </ContextMenu>
                        </Button.ContextMenu>
                        <Button.Style>
                            <Style TargetType="Button">
                                <EventSetter Event="Click" Handler="DropDownButton_Click"/>
                            </Style>
                        </Button.Style>
                    </Button>
                </ToolBar>
            </ToolBarTray>
        </Grid>

        <!-- STATUSBAR -->
        <StatusBar DockPanel.Dock="Bottom">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}" />
            </StatusBarItem>
        </StatusBar>

        <!-- CONTENT -->
        <Grid Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="360"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- LINKS -->
            <StackPanel Grid.Column="0">
                <TextBlock Text="WÃ¤hlen Sie einen Tag" FontWeight="SemiBold" Margin="0,0,0,6" FontSize="20"/>
                <Calendar SelectedDate="{Binding SelectedDate}"
                          CalendarDayButtonStyle="{StaticResource FullyBookedCalendarDayButtonStyle}"
                          ToolTip="WÃ¤hle den Tag, fÃ¼r den du die TicketverfÃ¼gbarkeit sehen willst."/>

                <TextBlock Text="Tickets (Status)" FontWeight="SemiBold" Margin="0,10,0,6" FontSize="20"
                           ToolTip="Eine Ãœbersicht der BuchungsverfÃ¼gbarkeit fÃ¼r den gewÃ¤hlten Tag."/>

                <ListBox ItemsSource="{Binding Tickets}"
                         SelectedItem="{Binding SelectedTicket}"
                         Height="330">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Margin" Value="0,0,0,6"/>
                        </Style>
                    </ListBox.ItemContainerStyle>

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Padding="8" CornerRadius="10" ToolTip="{Binding TooltipText}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="90"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Text="{Binding TicketCode}" FontWeight="SemiBold"/>

                                    <TextBlock Grid.Column="1" Text="{Binding StatusText}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Opacity" Value="0.85"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsBooked}" Value="True">
                                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </StackPanel>

            <!-- RECHTS -->
            <StackPanel Grid.Column="1" Margin="14,0,0,0">
                <TextBlock Text="Details" FontSize="20" FontWeight="SemiBold" Margin="0,0,0,10"/>

                <TextBlock Text="AusgewÃ¤hltes Ticket" Margin="0,0,0,4"/>
                <Border Background="White" BorderBrush="#FFABADB3" BorderThickness="1" Padding="2">
                    <TextBlock Text="{Binding SelectedTicket.TicketCode, TargetNullValue='-'}"/>
                </Border>

                <TextBlock Text="Status" Margin="0,10,0,4"/>
                <Border Background="White" BorderBrush="#FFABADB3" BorderThickness="1" Padding="2">
                    <TextBlock Text="{Binding SelectedTicket.StatusText, TargetNullValue='-'}"/>
                </Border>

                <TextBlock Text="NÃ¤chster freier Tag" Margin="0,10,0,4"/>
                <Border Background="White" BorderBrush="#FFABADB3" BorderThickness="1" Padding="2">
                    <TextBlock Text="{Binding SelectedTicket.NextFreeDate, StringFormat=dd.MM.yyyy, TargetNullValue='-'}"/>
                </Border>

                <TextBlock Text="Aktionen" FontWeight="SemiBold" FontSize="20" Margin="0,14,0,6"/>
                <StackPanel Orientation="Horizontal">
                    <Button Content="Neu..." Command="{Binding NewBookingCommand}" />
                    <Button Content="Kopieren..." Command="{Binding CopyBookingCommand}" />
                    <Button Content="LÃ¶schen" Command="{Binding DeleteCommand}" />
                </StackPanel>

                <TextBlock Margin="0,30,0,0" FontWeight="SemiBold" FontSize="16">Hinweis zur Buchung</TextBlock>
                <TextBlock TextWrapping="Wrap" Opacity="0.85">
                    <TextBlock.Inlines>
                        <Run Text="Um eine neue Buchung zu erstellen, klicke auf "/>
                        <Bold>Neu</Bold>
                        <Run Text=" oder "/>
                        <Bold>Kopieren.</Bold>
                        <Run Text="Es Ã¶ffnet sich ein neues Fenster, in welchem zusÃ¤tzliche Buchungsdetails eingegeben werden kÃ¶nnen. Bitte beachte, dass die Kopieren-Funktion automatisch den nÃ¤chsten freien Tag vorschlÃ¤gt."/>
                    </TextBlock.Inlines>
                </TextBlock>

                <TextBlock TextWrapping="Wrap" Opacity="0.85" Margin="0,6,0,0">
                    <TextBlock.Inlines>
                        <Run Text="Um eine bestehende Buchung zu lÃ¶schen, klicke zuerst das entsprechende Datum in der KalenderÃ¼bersicht an und wÃ¤hle dann in der VerfÃ¼gbarkeitsÃ¼bersicht (unter dem Kalender) das Ticket aus. Dann klickst du auf "/>
                        <Bold>LÃ¶schen.</Bold>
                        <Run Text="Dadurch wird die Buchung entfernt und das entsprechende Ticket ist an diesem Tag wieder verfÃ¼gbar."/>
                    </TextBlock.Inlines>
                </TextBlock>

                <!-- neues Abschnitt ausgebuchte Tage unter dem Details und Hinweis Bereich hinzugefÃ¼gt, Anzeige von Informationen, wenn im aktuell ausgewÃ¤hlten Monat komplett ausgebcuhte Tage vorhanden sind. -->

                <TextBlock Text="Ausgebuchte Tage" Margin="0,18,0,8" FontWeight="SemiBold" FontSize="20"/>
                <Border Background="#FFF9F9F9" BorderBrush="#FFABADB3" BorderThickness="1" Padding="8" CornerRadius="3">
                    <TextBlock Text="{Binding FullyBookedDatesText}" 
                               TextWrapping="Wrap" 
                               FontSize="12"
                               Foreground="#FF333333"/>
                </Border>
            </StackPanel>

        </Grid>
    </DockPanel>
</Window>
